language: generic
os:
  - osx
  - linux
dist: trusty
sudo: false
cache:
  directories:
    - "$HOME/Library/texlive/2016basic/texmf-var/luatex-cache"
    - "$HOME/texlive/2016/texmf-var/luatex-cache"
before_install:
  - wget https://raw.githubusercontent.com/y-yu/install-tex-travis/master/install-tex.sh
  - wget https://raw.githubusercontent.com/y-yu/install-tex-travis/master/tlmgr.sh
  - chmod +x install-tex.sh tlmgr.sh
install:
  - . ./install-tex.sh
  - ./tlmgr.sh update --self --all || echo "ignore errors"
  - ./tlmgr.sh install latexmk collection-luatex collection-langjapanese collection-fontsrecommended type1cm mdframed needspace everyhook svn-prov
  - if [[ "${TRAVIS_OS_NAME}" == "osx" ]]; then
      sudo fmtutil-sys --all;
    fi
script:
  - cd articles/hinagata
  - autoconf
  - ./configure
  - make
  - ./configure --enable-luatex
  - make
  - if [[ "${TRAVIS_OS_NAME}" == "osx" ]]; then
      export WORD_FONT=hiragino-pron;
      make clean;
      make;
    fi

  - cmake -DENABLE_LUATEX=OFF .
  - make
  - make clean
  - cmake -DENABLE_LUATEX=ON .
  - make
  - if [[ "${TRAVIS_OS_NAME}" == "osx" ]]; then
      export WORD_FONT=hiragino-pron;
      make clean;
      make;
    fi

